<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于var,let 与const | Risexie</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.01caefc4.css" as="style"><link rel="preload" href="/assets/js/app.56f95d45.js" as="script"><link rel="preload" href="/assets/js/6.abb57fce.js" as="script"><link rel="prefetch" href="/assets/js/4.ab5bcf37.js"><link rel="prefetch" href="/assets/js/1.60b27f52.js"><link rel="prefetch" href="/assets/js/2.87ffcd93.js"><link rel="prefetch" href="/assets/js/3.08b20e69.js"><link rel="prefetch" href="/assets/js/5.08ff075f.js"><link rel="prefetch" href="/assets/js/7.5d8e94ce.js"><link rel="prefetch" href="/assets/js/8.34bb0783.js"><link rel="prefetch" href="/assets/js/9.5924d11a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.01caefc4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Risexie
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/lists/let与const.html" class="nav-link">Blog</a></div><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/lists/let与const.html" class="nav-link">Blog</a></div><div class="nav-item"><a href="/about.html" class="nav-link">About</a></div><!----></nav><ul class="sidebar-links"><li><a href="/lists/let与const.html" class="active sidebar-link">关于var,let 与const</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lists/let与const.html#令人头疼的var" class="sidebar-link">令人头疼的var</a></li><li class="sidebar-sub-header"><a href="/lists/let与const.html#提升-与tdz" class="sidebar-link">'提升'与TDZ</a></li><li class="sidebar-sub-header"><a href="/lists/let与const.html#变量声明的三个阶段" class="sidebar-link">变量声明的三个阶段</a></li><li class="sidebar-sub-header"><a href="/lists/let与const.html#循环中的块级作用域" class="sidebar-link">循环中的块级作用域</a></li><li class="sidebar-sub-header"><a href="/lists/let与const.html#const" class="sidebar-link">Const</a></li></ul></li><li><a href="/lists/关于Promise.html" class="sidebar-link">关于Promise(上)</a></li><li><a href="/lists/关于Promise2.html" class="sidebar-link">关于Promise(下)</a></li><li><a href="/lists/通过十道练习题，看Promise特点.html" class="sidebar-link">通过十道Promise练习题，看Promise特点</a></li><li><a href="/lists/关于Iterator.html" class="sidebar-link">关于interator</a></li><li><a href="/lists/关于Generator.html" class="sidebar-link">关于Generator</a></li></ul></div><div class="page"><div class="content"><h1 id="关于var-let-与const"><a href="#关于var-let-与const" aria-hidden="true" class="header-anchor">#</a> 关于var,let 与const</h1><p>在ES6发布之前，我们声明变量一直都是使用var关键字，但是var实在是存在很多不同的问题，以至于很多人一直对Js诸多诟病，还好let和const在很大程度上解决了这些问题，让JS更加趋于规范化。</p><h2 id="令人头疼的var"><a href="#令人头疼的var" aria-hidden="true" class="header-anchor">#</a> 令人头疼的var</h2><p>说起var，那可不是浪得虚名，在众多的面试题当中都可以看到他的身影。</p><ul><li>变量声明提升</li></ul><div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'xiaoming'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">//'xiaoming'</span>
</code></pre></div><p>使用var声明的变量都会有声明提升的问题，在我们赋值之前，它就已经初始化，所以值为undefined,而let则则不会有这个问题</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught ReferenceError: name is not defined</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'xiaoming'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">//'xiaoming'</span>
</code></pre></div><ul><li>循环体内的变量泄露为全局变量</li></ul><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">//10</span>
</code></pre></div><p>一个很普通的for循环，想依次输出i的值，但是使用var声明的循环变量却会泄露为并污染全局变量，而改用let，则可以生成块级作用域，在全局作用域无法访问。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">//  Uncaught ReferenceError: i is not defined</span>
</code></pre></div><ul><li>可以重复声明</li></ul><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 2</span>
</code></pre></div><p>let则不行</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught SyntaxError: Identifier 'value' has already been declared</span>
</code></pre></div><ul><li>绑定全局作用域</li></ul><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'xiaoing'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>windows<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'xiaoming';</span>
</code></pre></div><p>let 则不会</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>windows<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment">//undefined</span>
</code></pre></div><h2 id="提升-与tdz"><a href="#提升-与tdz" aria-hidden="true" class="header-anchor">#</a> '提升'与TDZ</h2><div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'xiaoming'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment">//'xiaoming'</span>
</code></pre></div><p>同样以上面的例子为例，我们知道用var会出现上述问题，是因为var会使变量的声明提升，也就是相当于一下的代码。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> name<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'xiaoming'</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token comment">//'xiaoming'</span>
</code></pre></div><p>而很多人认为，使用let关键字会直接报错，是因为let其实并不会提升，所以让我们尝试去输出name的值的时候，因为暂时性死区，所以我们无法访问它。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token comment">//TDZ开始</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">//ReferenceError</span>
    x <span class="token operator">=</span> <span class="token string">'aaa'</span> <span class="token comment">//ReferenceError</span>

    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">'xiaoming'</span> <span class="token comment">//TDZ结束</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所谓的'提升'(hosting)，并不是一个专业名词。在EcmaScript的相关规范里面，我们并不能找到关于(hosting)的内容。所谓的提升更像是我们程序员为了便于理解，而创造出来的词。在看似简单的'提升'过程，其实里面还包含了更多的细节，所以仅仅用'提升'就尝试解释背后的真正原因，其实并不严谨。</p><h2 id="变量声明的三个阶段"><a href="#变量声明的三个阶段" aria-hidden="true" class="header-anchor">#</a> 变量声明的三个阶段</h2><p>在Js当中声明一个变量其实包含三个阶段，我们不能让他们与'提升'混为一谈。
他们分别为</p><blockquote><ol><li>Declaration phase 声明阶段</li><li>Initialization phase 初始化阶段</li><li>Assignment phase 赋值阶段</li></ol></blockquote><h3 id="var声明变量的三个阶段"><a href="#var声明变量的三个阶段" aria-hidden="true" class="header-anchor">#</a> var声明变量的三个阶段</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> name
name <span class="token operator">=</span> <span class="token string">'xiaoming'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token comment">//'xiaoming'</span>
</code></pre></div><p>当我们使用var来声明一个变量，在任何具体的语句被运行前，变量name就马上通过了<em>声明阶段</em>和<em>初始化阶段</em>,然后执行<code>console.log()</code>语句，再通过<em>赋值阶段</em>,最后才被打印出来。又因为在初始化的时候就会给变量赋值为<code>undefined</code>，所以在<em>赋值阶段</em>之前就尝试打印，那么出来的结果自然是<code>undefined</code>。</p><p>而我们平时所说的所谓'提升',严格上来说是包括了声明阶段和初始化阶段，使用var关键字来声明变量，他们基本上是同时进行的。</p><h3 id="let-声明变量的三个阶段"><a href="#let-声明变量的三个阶段" aria-hidden="true" class="header-anchor">#</a> let 声明变量的三个阶段</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
<span class="token keyword">let</span> name
name <span class="token operator">=</span> <span class="token string">'xiaoming'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token comment">//'xiaoming'</span>
</code></pre></div><p>使用let声明变量，大部分阶段所做的事情是一样的，先马上通过<em>声明阶段</em>，然后逐行执行我们的代码。差别主要在于<em>声明阶段</em>和<em>初始化阶段</em>之间，与var不同的是，这两阶段之间并不是没有间隔的，而他们阶段的分割点就在与<code>let name</code>这一行。在这之前，变量其实并没有初始化，而通过了<em>声明阶段</em>但又没有通过<em>初始化阶段</em>的变量此时，就处于我们所说的<em>暂时性死区</em>。此时我们无法访问变量，如果尝试访问会报错ReferenceError。</p><h3 id="声明函数的三个阶段"><a href="#声明函数的三个阶段" aria-hidden="true" class="header-anchor">#</a> 声明函数的三个阶段</h3><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>声明函数通过会通过以上所说的三个阶段，只不过他们都在代码被逐行运行之前的一瞬间就通过了，我们并没有感觉到他们的存在，所以我们可以在全局的任何地方调用<code>fn</code>函数。</p><p>综上所述，'提升'并没有我们所想象的那么简单，使用var和let声明变量和声明函数都经过了三个阶段，但经过阶段的过程不同，最后造成了他们的差别。而真正的提升所指的，其实是不同阶段的提升。</p><ul><li>Var <em>声明阶段</em>和<em>初始化阶段</em>提升了，所以我们可以在<em>var xxx</em>之前访问变量</li><li>Let 只有<em>声明阶段</em>提升了，在<em>let xxx</em>之前变量处于暂时性死区，无法访问</li><li>声明函数的三个阶段都提升了，我们可以在当前作用域内任意地方访问</li></ul><h2 id="循环中的块级作用域"><a href="#循环中的块级作用域" aria-hidden="true" class="header-anchor">#</a> 循环中的块级作用域</h2><p>一个很常见的面试题</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> funs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    funs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
fun<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>使用Let可以解决这个问题</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> funs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    funs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
fun<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// </span>
</code></pre></div><p>但我们不是在开篇就说了let无法重复声明么? 为什么这里就不报错了?
其实这里在<code>for</code>循环的圆括号之间，创建了一个隐藏的作用域，然后在每次循环迭代的时候就创建一个新变量，然后用上一次迭代中同名变量的值让其初始化，这样我们就解释了let在for循环中不报错的原因了。
上面的代码，其实在底层相当于这样子</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 伪代码</span>
<span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    funcs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    funcs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    funcs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="const"><a href="#const" aria-hidden="true" class="header-anchor">#</a> Const</h2><p>用Const声明的变量，一旦声明，值就不能改变</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> aaa <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
aaa <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Assignment to constant variable.</span>
</code></pre></div><p>当然，const的本质上保证的并不是变量的值不能改动，而是变量指针所指向的那么内存地址所保存的值不能改动。而如果我们声明的是简单类型的数据，值就保存在变量所指的内容地址。所以值无法改变。</p><p>但如果我们声明的是复杂内容的数据，例如对象或者数组，那么变量所保存内存地址也只是一个指向实际数据的指针，我们可以保证这个指针不被改变，但是无法保证实际数据不被改变。</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">'xiaoming'</span>
    age<span class="token punctuation">:</span><span class="token number">20</span>
<span class="token punctuation">}</span>
person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>age<span class="token punctuation">}</span> <span class="token operator">=</span> person
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token comment">//18</span>
</code></pre></div></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/6.abb57fce.js" defer></script><script src="/assets/js/app.56f95d45.js" defer></script>
  </body>
</html>
